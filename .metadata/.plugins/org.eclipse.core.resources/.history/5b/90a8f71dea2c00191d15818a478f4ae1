package application;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.fxml.FXML;
import javafx.scene.control.Button;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TextArea;
import javafx.scene.control.TextField;

import java.io.FileReader;

import com.google.gson.*;

public class Controller {

	@FXML TextArea songCurrent;

	@FXML TableView<Song> table;
	@FXML TableColumn<Song,String> tableName;
	@FXML TableColumn<Song,String> tableArtist;
	@FXML TableColumn<Song,String> tableAlbum;
	@FXML TableColumn<Song,String> tableYear;


	@FXML TextField newSongName;
	@FXML TextField newSongArtist;
	@FXML TextField newSongAlbum;
	@FXML TextField newSongYear;
	@FXML Button newSongSubmit;

	Gson gson;
	JsonParser jsonParser;
	JsonElement jsonRoot;
	JsonObject jsonObj;
	JsonArray jsonArray;

	String tempName;
	String tempArtist;
	String tempAlbum;
	String tempYear;

	private ObservableList<Song> songList;

	public void start(Stage mainStage) throws JsonIOException, JsonSyntaxException, FileNotFoundException {


		songList = FXCollections.observableArrayList();

		gson = new Gson();
		jsonParser = new JsonParser();
		jsonRoot = jsonParser.parse(new FileReader("src/savedSongs.json"));
		jsonObj = jsonRoot.getAsJsonObject();
		jsonArray = jsonObj.getAsJsonArray("songList");

		for(int i = 0; i < jsonArray.size();i++) {
			songList.add(gson.fromJson(songList.get(i), Song.class));
		}

		songList.setItems(songList);

		/*if(songs.size() == 0) {
			editBtn.setDisable(true);
			deleteBtn.setDisable(true);
			tips.setText("Tip: Press the add button to add a new song.");
		}
		sortSongs();

		updateListInfo();
		*/

		// select the first item
		songList.getSelectionModel().select(0);


	    showItem(mainStage);
	    songList
	       .getSelectionModel()
	       .selectedIndexProperty()
	       .addListener(
	          (obs, oldVal, newVal) ->
	              showItem(mainStage));

	}


	//INCOMPLETE
	//occurs when the submit button for a new song is pressed
	public void addNewSong(ActionEvent e){
		Button b = (Button)e.getSource();
		if(b == newSongSubmit){
			String name = newSongName.getText();
			String artist = newSongArtist.getText();
			String year = newSongYear.getText();
			String album = newSongAlbum.getText();

			if(newSongName.getText() == null || newSongArtist.getText() == null){
					//display "invalid entry"
			}else{


			}
		}
	}
	//list all songs
	public ObservableList<Song> listSongs(){



	}
}
